{% extends "@UVDeskCoreFramework//Templates//layout.html.twig" %}

{% block title %} 
	{{ 'Form Builder'|trans }}
{% endblock %}

{% block pageContent %}
	<style>
		.section-heading {
			font-size: 16px;
			margin: 0px;
			line-height: 1.4em;
		}
		.section-description {
			color: #6F6F6F;
			margin-top: unset !important;
			margin-bottom: 20px;
			line-height: 1.4em;
		}
		.uv-element-block .uv-field-message {
			font-style: normal;
			margin: 0px 0px 20px 0px;
		}
        .uv-field-info {
            display: block;
            font-style: italic;
            color:#6F6F6F;
        }
        .li-item {
            width: 36%;
            border: 1px dashed gray;
            box-sizing: border-box;
            padding: 5px;
            border-radius: 2px;
            list-style-type: none;
            margin: 10px; 
        }
        .uv-cf-textbox {
            width: 24px;
            height: 20px;
            display: inline-block;
            vertical-align: left;
            background-position: 0px -181px;
        }
        .uv-cf-textarea {
            width: 24px;
            height: 20px;
            display: inline-block;
            vertical-align: left;
            background-position: -25px -181px;
        }
        .uv-checkbox input{
            cursor: pointer;
            margin: 0;
        }
        .uv-dashed-field {
            display: inline-block;
            border: 1px dashed gray;
            padding: 5px;
            border-radius: 2px; 
            box-sizing: border-box; 
            width: 34%;
            margin-bottom: 10px;   
        }
        .mandatory-fields {
            border: 1px solid gray;
            width: 46%;
            border-radius: 4px;
            box-sizing: border-box;
            padding: 10px; 
        }
        .optional-fields {
            margin-top: 15px; 
            border: 1px solid gray;
            width: 46%;
            border-radius: 4px;
            box-sizing: border-box;
            padding: 10px; 
        }
        .uv-field-info{
            margin-bottom: 10px; 
        }
        .cf-item{
            list-style-type: none; 
            margin-left: 40px; 
        }
        #ticket-form {
            margin-left: 60px; 
            margin-top: 30px; 
        }
        .validation-message {
            color: red;
        }
        .textarea {
            margin-top: 30px;
        }
        #create-ticket-btn {
            margin-top: 10px; 
            display: inline-block;
            z-index: 999; 
        }
        .form-builder-checkbox {
            padding: 20px; 
        }
        .heading {
            color: #9d9d9d;
            font-weight: bold;
            font-size: 18px;
            margin: 10px 0 15px 0;
        }
        .read {
            pointer-events: none;
        }
        .read form {
            border: none;
            width: 100%;
        }
	</style>

	<div class="uv-inner-section">
		{# Append Panel Aside #}
		{% set asideTemplate = 'Webkul\\UVDesk\\CoreFrameworkBundle\\Dashboard\\AsideTemplate' %}
		{% set asideSidebarReference = 'Webkul\\UVDesk\\ExtensionFrameworkBundle\\UIComponents\\Dashboard\\Homepage\\Sections\\Apps' %}
		{{ uvdesk_extensibles.getRegisteredComponent(asideTemplate).renderSidebar(asideSidebarReference) | raw }}  

		<div class="uv-view {% if app.request.cookies and app.request.cookies.get('uv-asideView') %}uv-aside-view{% endif %}">
 
            
            {% if formbuilder is not empty and formbuilder.id is defined %}
				<h1>{{ 'Update Form Builder'|trans }}</h1>
			{% else %}
				<h1>{{ 'New Form Builder'|trans }}</h1>
			{% endif %}


            <div class="uv-hr"></div>

            {% if formbuilder is not empty %}
             <form method="post" action="{{ path('formbuilder_update_configuration', {'id': formbuilder.id}) }}" id="formbuilder-settings-view">
            {% else %}
			    <form method="post" action="{{ path('formbuilder_create_configuration') }}" id="formbuilder-settings-view">
            {% endif %}
				
                <label class="uv-field-label">Form Name</label>
				<div class="uv-element-block">
					<div class="uv-field-block">
						{% if formbuilder is defined and formbuilder.id is defined %}
							<input type="text" name="form_name" class="uv-field form-name-input" value="{{formbuilder.form_name}}" required/>
						{% else %}
							<input type="text" name="form_name" class="uv-field form-name-input" value="" placeholder="Form Name" required/>
						{% endif %}
					</div>
                    <span class="uv-field-info">{{ 'It will be shown in the list of created forms'|trans }}</span>
				</div>
                <div class="uv-hr mar-right-neg-25"></div>

                {% if formbuilder is defined and formbuilder.id is defined %}
                    <div class="uv-element-block">
                        <label class="uv-field-label">ID:</label>
                        <div class="uv-field-block">
                            <input type="text" name="id" class="uv-field" value="{{ formbuilder.id}}" disabled />
                        </div>
                    </div>
                {%  endif %}


                <div class="mandatory-fields">
                    <div class="heading">
                        {{ "MANDATORY FIELDS"|trans}}
                    </div>
                    <span class="uv-field-info">{{ "These fields will be visible in form and can't be edited"|trans }}</span>
                    <ul>
                        <li class="li-item">
                            <span class="uv-cf-textbox"></span>
                            Email
                            <input type="hidden" name="" value="">
                        </li>
                        <li class="li-item">
                            <span class="uv-cf-textarea"></span>
                            Reply
                        </li>
                    </ul>
                </div>

                <div class="optional-fields">
                    {# {% if formbuilder is empty %} #}
                        <div class="heading">
                            OPTIONAL FIELDS
                        </div>
                        <span class="uv-field-info">Select These Fields to Add in your Form</span>
                    {# {% endif %} #}
                    <ul style="list-style-type:none;">
                        <li>
                            <div class="uv-checkbox">
                                {% if formbuilder is not empty and formbuilder.name == '1' %}
                                    <input type="checkbox"  name="name" value="1" checked>
                                {% else %}
                                    <input type="checkbox"  name="name" value="1">
                                {% endif %}
                                <span class="uv-checkbox-view"></span>
                            </div>
                            <div class="uv-dashed-field">
                                <span class="uv-cf-textbox"></span>
                                Name
                            </div>
                        </li>
                        <li>
                            <div class="uv-checkbox">
                                    {% if formbuilder is not empty and formbuilder.type == '1' %}
                                        <input type="checkbox" id="formbuilder_type" name="type" value="1" checked>
                                    {% else %}
                                        <input type="checkbox" id="formbuilder_type" name="type" value="1" >
                                    {% endif %}
                                <span class="uv-checkbox-view"></span>
                            </div>
                            <div class="uv-dashed-field">
                                <span class="uv-cf-select"></span>
                                Type
                            </div>
                        </li>
                        <li>
                            <div class="uv-checkbox">

                                {% if formbuilder is not empty and formbuilder.subject == '1'%}
                                    <input type="checkbox" id="formbuilder_subject" name="subject" value="1" checked>
                                {% else %}
                                    <input type="checkbox" id="formbuilder_subject" name="subject" value="1" >
                                {% endif %}
                                <span class="uv-checkbox-view"></span>
                            </div>
                            <div class="uv-dashed-field">
                                <span class="uv-cf-textarea"></span>
                                Subject
                            </div>
                        </li>
                      {#  <li>
                            <div class="uv-checkbox">
                                {% if formbuilder is not empty and formbuilder.gdpr == '1'%}
                                    <input type="checkbox" id="formbuilder_gdpr" name="gdpr" value="1" checked>
                                {% else %}
                                    <input type="checkbox" id="formbuilder_gdpr" name="gdpr" value="1">
                                {% endif %}
                                <span class="uv-checkbox-view"></span>
                            </div>
                            <div class="uv-dashed-field">
                                <span class="uv-cf-textarea"></span>
                                GDPR
                            </div>
                        </li> #}
                        <li>
                                <div class="uv-checkbox">

                                    {% if formbuilder is not empty and formbuilder.order_no == '1'%}
                                        <input type="checkbox" id="formbuilder_order_no" name="order_no" value="1" id="check1238" checked>
                                    {% else %}
                                        <input type="checkbox" id="formbuilder_order_no" name="order_no" value="1" id="check1238" >
                                    {% endif %}
                                    <span class="uv-checkbox-view"></span>
                                </div>
                                <div class="uv-dashed-field">
                                    <span class="uv-cf-textbox"></span>
                                    Order#
                                </div>
                        </li>
                        <li>
                                <div class="uv-checkbox">

                                    {% if formbuilder is not empty and formbuilder.file == '1' %}
                                        <input type="checkbox" id="formbuilder_file" name="file" value="1" id="check1246" checked>
                                    {% else %}
                                        <input type="checkbox" id="formbuilder_file" name="file" value="1" id="check1246">
                                    {% endif %}
                                    <span class="uv-checkbox-view"></span>
                                </div>
                                <div class="uv-dashed-field">
                                    <span class="uv-cf-textbox"></span>
                                    File Attachment
                                </div>
                        </li>

                    </ul>

                    {# Render the bottom when creating a new formbuilder #}
                    {%  if customfields is defined and customfields is not empty %}

                            {% if customfields is defined and customfields is not null %}
                                <div class="heading">
                                    CUSTOM FIELDS 
                                </div>
                                <span class="uv-field-info">Select These Custom Fields to Add in your Form</span>
                            {% endif %}

                            {% for customfield in customfields %}


                                {% if customfield.fieldType is defined and customfield.fieldType == 'text'%}
                                    
                                <li class="cf-item">
                                  <div class="uv-checkbox">
                                        <input type="checkbox" name="cf[]" value="{{ customfield.id }}" >
                                        <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                
                                {% endif %}
                         
                                {% if customfield.fieldType is defined and customfield.fieldType == 'textarea' %}
                                	
                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                
                                {% endif %}


                                {% if customfield.fieldType is defined and customfield.fieldType == 'radio' %}
                                	
                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>

                                {% endif %}

                                {% if customfield.fieldType is defined and customfield.fieldType == 'select' %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}



                                {% if customfield.fieldType is defined and customfield.fieldType == 'checkbox' %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}


                                {% if customfield.fieldType is defined and customfield.fieldType == 'date' %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}


                                {% if customfield.fieldType is defined and customfield.fieldType == 'time' %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                {% endif %}

                                {% if customfield.fieldType is defined and customfield.fieldType == 'datetime' %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}

                                {% if customfield.fieldType is defined and customfield.fieldType == 'file' %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                         <input type="checkbox"  name="cf[]" value="{{ customfield.id }}">
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ customfield.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}

                            {% endfor %}                    

                    {% endif %}

                    {# if user is updating pre-existing form-builder #}
                    {% if customFields is defined and customFields is not empty %}
                        
                            <div class="heading">
                                {{"CUSTOM FIELDS "|trans}}
                            </div>

                    {% set check_val_one = 0 %}   
                    {% set check_val_two = 0 %}

                        {% for sf in selectedCustomFields %}
                            {% for cf in customFields %} 

                             {% if cf.fieldType is defined and cf.fieldType == 'text' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                    
                                <li class="cf-item">
                                    <div class="uv-checkbox">

                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                            <input type="checkbox" name="cf[]" value="{{ cf.id }}" checked>
                                        {% else %}
                                             <input type="checkbox" name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>

                                {% endif %}


                                {% if cf.fieldType is defined and cf.fieldType == 'textarea' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                	
                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                          {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                          {% else %}
                                             <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                          {% endif %}
                                          {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>
                                
                                {% endif %}

                                {% if cf.fieldType is defined and cf.fieldType == 'radio' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                	
                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                        {% else %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>

                                {% endif %}


                                {% if cf.fieldType is defined and cf.fieldType == 'select' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                        {% else %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}


                                {% if cf.fieldType is defined and cf.fieldType == 'checkbox' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                         <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                        {% else %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>
                                	
                                {% endif %} 


                                {% if cf.fieldType is defined and cf.fieldType == 'date' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                         <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                        {% else %}
                                         <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}


                                {% if cf.fieldType is defined and cf.fieldType == 'time' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                         <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                        {% else %}
                                             <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>
                                {% endif %}

                                {% if cf.fieldType is defined and cf.fieldType == 'datetime' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                        {% else  %}
                                            <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}

                                {% if cf.fieldType is defined and cf.fieldType == 'file' and cf.id > check_val_two and check_val_two == check_val_one and (cf.agentType == 'apps' or cf.agentType == 'both') %}

                                <li class="cf-item">
                                    <div class="uv-checkbox">
                                        {% if sf is not empty and sf.id == cf.id and sf.checked == true  %}
                                         <input type="checkbox"  name="cf[]" value="{{ cf.id }}" checked>
                                        {% else  %}
                                        <input type="checkbox"  name="cf[]" value="{{ cf.id }}" >
                                        {% endif %}
                                        {% set check_val_two = cf.id  %}
                                         <span class="uv-checkbox-view"></span>
                                    </div>
                                    <div class="uv-dashed-field">
                                        <span class="uv-cf-textbox"></span>
                                        {{ cf.name }}
                                    </div>
                                </li>
                                	
                                {% endif %}
                            {% endfor %}
                            {% set check_val_one = check_val_two %}
                        {% endfor %}
                         
                    {% endif %}
                    <span class="uv-field-info">You can add more optional field(s) from <a href="{{ path('uvdesk_form_component_custom_fields') }}">{{"Custom Fields"|trans}}</a></span>
                </div>

				{% if formbuilder is not empty and formbuilder.id is defined  %}
					<input class="uv-btn btn-submission"  href="#" value="{{ 'Update'|trans }}" type="submit">
                    <input class="uv-btn" id="preview-modal-btn"  value="{{ 'Preview'|trans }}" type="button">
                    <input class="uv-btn" id="embed-modal-btn" value="{{'Embed'|trans}}" type="button">
				{% else %}
					<input class="uv-btn btn-submission" href="#" value="{{ 'Create FormBuilder'|trans }}" type="submit">
				{% endif %}
			</form>

   
            {# START MODAL #}
            <div class="uv-pop-up-overlay uv-no-error-success-icon" id="hints">
                <div class="uv-pop-up-box uv-pop-up-wide">
                    <span class="uv-pop-up-close"></span>
                    <div class="modal-body read">
                    {% if formbuilder is not empty and formbuilder.id is defined %}
                        <form method="POST"  enctype="multipart/form-data" >
                            <h2><b>{{ formbuilder.form_name }}</b></h2>
                            {% for uf in UpdatedFields %}

                            {% if uf.fieldId is defined and uf.fieldId == '101' %}
                            <div class="uv-element-block">
                                <label class="uv-field-label">{{ uf.name }}</label>
                                    <div class="uv-field-block">
                                        <input name="name" class="uv-field create-ticket" type="text" value="" required>
                                        <span class="validation-message"></span>
                                    </div>
                                <span class="uv-field-info">{{ uf.placeholder }}</span>
                            </div>
                            {% endif %}

                            {% if uf.fieldId is defined and uf.fieldId == '102' %}
                            {# Email is a mandatory field. #}
                            <div class="uv-element-block">
                                <label class="uv-field-label">{{ uf.name }}</label>
                                    <div class="uv-field-block">
                                        <input name="email" class="uv-field create-ticket" type="text" value="" required> 
                                        <span class="validation-message"></span>
                                    </div>
                                <span class="uv-field-info">{{ uf.placeholder }}</span>
                            </div>
                            {% endif %}

                            {% if uf.fieldId is defined and uf.fieldId == '105' %}
                            <div class="uv-element-block">
                                <label class="uv-field-label">{{ uf.name |trans }}</label>
                                    <div class="uv-field-block">
                                        <textarea name="reply" class="uv-field create-ticket" type="text" id='ticket-message'></textarea required>
                                        <span class="validation-message"></span>
                                    </div>
                                <span class="uv-field-info">{{  uf.placeholder |trans }}</span>
                            </div>
                            {% endif %}

                            {% if formbuilder.type == '1' and uf.fieldId is defined and uf.fieldId == '104' %}
			                <div class="uv-element-block">
				                <label class="uv-field-label">{{ uf.name |trans }}</label>
				                    <div class="uv-field-block">
					                    <select name="type" class="uv-select create-ticket" id="type">
						                    <option value="">{{ 'Select type'|trans }}</option>

							                {% for type in ticket_service.getTypes() %}
								                <option value="{{ type.id }}" {{ post.type is defined and post.type == type.id ? 'selected' : '' }}>{{ type.name }}</option>
							                {% endfor %}
					                    </select>
				                    </div>
					            <span class="uv-field-info">{{  uf.placeholder |trans }}</span>
			                </div>
                            {% endif %}

                            {% if formbuilder.subject == '1' and uf.fieldId is defined and uf.fieldId == '103' %}
                                <div class="uv-element-block">
                                    <label class="uv-field-label">{{ uf.name |trans }}</label>
                                        <div class="uv-field-block">
                                            <input name="subject" class="uv-field create-ticket" type="text" value="" required>
                                            <span class="validation-message"></span>
                                        </div>
                                    <span class="uv-field-info">{{  uf.placeholder |trans }}</span>
                                </div>
                            {% endif %}

                            {% if formbuilder.order_no == '1' and uf.fieldId is defined and uf.fieldId == '106' %}
                                <div class="uv-element-block">
                                    <label class="uv-field-label">{{ uf.name |trans }} #</label>
                                        <div class="uv-field-block">
                                            <input name="order_no" class="uv-field create-ticket" type="text" value="" required>
                                            <span class="validation-message"></span>
                                        </div>
                                    <span class="uv-field-info">{{  uf.placeholder |trans }}</span>
                                </div>
                            {% endif %}

                            {% if formbuilder.file == '1' and uf.fieldId is defined and uf.fieldId == '107' %}
                                <div class="uv-element-block attachment-block uv-no-error-success-icon">
                                    <label>
                                        <input type="file" name="file">
                                    </label>
                                </div>
                            {% endif %}

                            {# {% if formbuilder.gdpr == '1' and uf.fieldId is defined and uf.fieldId == '108' %}
                                <div class="uv-element-block form-builder-checkbox">
                                    <div class="uv-field-block uv-vertical-align" name="gdpr_compliance">
                                        <input type="checkbox" id="gdpr" style="margin-left: unset;width: 20px;height: 25px;">
                                        <span style="position: relative;top: -8px">I agree to the <a href="https://www.uvdesk.com/en/gdpr" target="_blank">  Terms &amp; Conditions</a></span>
                                    </div>
                                </div>
                            {% endif %} #}

                            {% endfor %}

                            {% if selectedCustomFields is not empty and selectedCustomFields is defined %}
                                {% for cf in selectedCustomFields %}

                                    {% if cf.fieldType is defined and cf.fieldType == 'text' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                        <label class="uv-field-label">{{ cf.name }}</label>
                                        <div class="uv-field-block">
                                                <input name="customFields[{{  cf.id }}]" class="uv-field create-ticket" type="text" value="" id="{{ cf.id }}" required>
                                                <span class="validation-message"></span>
                                            </div>
                                            <span class="uv-field-info">{{  cf.value |trans }}</span>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'textarea' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields textarea">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                <input name="customFields[{{  cf.id }}]" class="uv-field create-ticket" type="textarea" value="" id="{{ cf.id }}" required>
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'radio' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                {% for options in cf.options %}
                                                <div class="uv-split-field">
                                                    <input type="radio"  name="customFields[{{  cf.id }}]" value="{{ options }}" >
                                                    <label for="{{ options }}">{{ options }}</label>
                                                </div>
                                                {% endfor %}
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'select' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                <select name="customFields[{{  cf.id }}]" class="uv-field create-ticket" value="{{ cf.id }}" id="{{ cf.id }}" required>
                                                    <option value="">{{ 'Select option' }}</option>
                                                    {% for options in cf.options %}
                                                        <option value="{{ options }}">{{ options }}</option>
                                                    {% endfor %}
                                                </select>
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'checkbox' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                {% for options in cf.options %}
                                                <div class="uv-split-field">
                                                    <input type="checkbox"  name="customFields[{{  cf.id }}]" value="{{ options }}" id="{{ cf.id }}"/>
                                                    <label for="{{ options }}"> {{ options }} </label>
                                                </div>
                                                {% endfor %}
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'date' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                <input name="customFields[{{  cf.id }}]" class="uv-field create-ticket" type="date" value="" id="{{ cf.id }}" required>
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'time' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                <input name="customFields[{{  cf.id }}]" class="uv-field create-ticket" type="time" value="" id="{{ cf.id }}" required>
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'datetime' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                <input name="customFields[{{  cf.id }}]" class="uv-field create-ticket" type="datetime-local" value="" id="{{ cf.id }}" required>
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {%  if cf.fieldType is defined and cf.fieldType == 'file' and (cf.agentType == 'apps' or cf.agentType == 'both') %}
                                        <div class="uv-element-block custom-fields">
                                            <label class="uv-field-label">{{ cf.name }}</label>
                                            <div class="uv-field-block">
                                                <input name="customFields[{{  cf.id }}]" class="uv-field create-ticket" type="file" value="" id="{{ cf.id }}" required>
                                                <span class="validation-message"></span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}

                            {% endif %}

                            <div>
                                <input type="submit"  id="create-ticket-btn" class="uv-btn" value="Create Ticket" />
                            </div> 
                            
                        </form>
                        

                    {% else %}
                        <h2> Unable to render FormBuilder Preview. </h2>
                    {% endif %}
                </div>
                
            </div>
            </div>

            {# END MODAL #}

            {% if formbuilder is not empty %}
            {# EMBED MODAL START #}           
                <div class="uv-pop-up-overlay uv-no-error-success-icon" id="embed-modal" >
                    <div class="uv-pop-up-box uv-pop-up-wide">
                        <span class="uv-pop-up-close"></span>
                        <h2 class="modal-title">Embed Code</h2>
                        {% set domainInfo = app.request.uri|split('/') %}
                        <div class="uv-tabs">
                            <ul>
                                <li for="js-tab" class="uv-tab-active">JS Version</li> 
                                <li for="iframe-tab">Iframe version</li>
                                <li for="puburl-tab">Public Url</li>
                            </ul>
                        </div>
                        <div id="js-tab" class="uv-tab-view uv-tab-view-active active_tab">
                            <textarea class="uv-field" readonly="" id="clipboard-value-js" style="resize:none;">&lt;div id="uv_top_message" class="uv_load"&gt;&lt;img src="https://cdn.uvdesk.com/bundles/webkuldefault/images/cssImages/loader.gif"&gt;&lt;/div&gt;&lt;script id="{{formbuilder.id}}" src="{{ domainInfo[0]~"//"~domainInfo[2] ~ path('formbuilder_previewJS_create_ticket', {'id': formbuilder.id}) }}" async="async" &gt; &lt;/script&gt; &lt;style&gt;.uv_load{min-height:400px;margin:0 auto}.uv_load img{position:relative;margin-top:25%;margin-left:-25%;}.uv_form .optionwrapper span,.uv_form label{margin-right:10px}.uv_form .optionwrapper label{display:inline-block;}.uv_form select{display:inline-block;background-color:#fff}#uv_top_message,.uv_form{width:600px;background-color:#fff;padding:10px;border-radius:4px;overflow-wrap:break-word}.uv_form input[type=checkbox]:hover,.uv_form input[type=radio]:hover{cursor:pointer}.uv_form label{display:block;text-transform:capitalize;color:#333;font-size:16px;margin-bottom:4px}.uv_form textarea{resize:vertical;min-height:60px}div.uv_show-error{color:#FF5656;font-size:15px;margin-top:5px;font-style:italic}.uv_form-control,.uv_selectpicker{width:70%;height:36px;border:1px solid #B1B1AE;border-radius:3px;display:inline-block;vertical-align:middle;transition:.2s cubic-bezier(.4,0,.2,1);padding:0 10px;font-size:15px;color:#333;margin:10px 0}.uv_form-control:focus,.uv_selectpicker:focus{outline:0;border-color:#66afe9;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.uv_form .optionwrapper *{vertical-align:top;color:#777}.uv_form .optionwrapper input{width:18px;height:18px}.uv_selectpicker{display:block}.uv_form-group{margin-bottom:10px;position:relative}.uv_form button[type=reset],.uv_form button[type=submit]{font-size:15px;padding:10px;color:#FFF;background-color:#7C70F4;display:inline-block;text-transform:uppercase;border-radius:3px;font-weight:700;border:none;font-family:inherit;cursor:pointer;vertical-align:middle;margin:5px 10px 5px 0;transition:.2s cubic-bezier(.4,0,.2,1)}.uv_form button:focus{outline:0}.uv_has_error checkbox,.uv_has_error input,.uv_has_error select,.uv_has_error textarea{border-color:#FF5656}@media only screen and (max-width:768px){.uv_form{width:90%}}.uv_flash{position:fixed;right:10px;top:10px;padding:10px 35px 10px 40px;color:#fff;background-color:#37bc9b;font-weight:700;width:320px;border-radius:5px}.uv_flash.success{background-color: #37bc9b}.uv_flash.danger{background-color: #da4453}.uv_form-group.uv_has_error:after{content:'';width:21px;height:21px;position:absolute}.uv_flash .close{position:absolute;top:10px;right:20px;cursor:pointer;font-size:21px;text-shadow:0 1px 0 #fff}.uv_has_error .uv_form-control:after{left:10px;display:inline-block;background-image:url(https://cdn.uvdesk.com/bundles/webkuldefault/images/uvdesk-sprite.svg);vertical-align:middle;margin-left:10px;background-position:0 -46px}.uv_form-group.uv_has_error:after{color:#a94442;background:url(https://cdn.uvdesk.com/bundles/webkuldefault/images/uvdesk-sprite.svg) 0 -46px;left:71%;top:40px}.uv-field-info{display: block;color: #6F6F6F;font-size: 15px;font-style: italic;}.uv_checkbox-control{height: 20px;width:20px;margin-right: 10px;}.display-ib{display:inline-block;}.uv_checkbox-control:focus{box-shadow: none}a{text-decoration: unset;}&lt;/style&gt;</textarea>
                            <button class="uv-btn uv-copy-button-js" data-copy-target="clipboard-value-js" type="button">Copy</button>
                        </div> 
                        <div id="iframe-tab" class="uv-tab-view">
                            <textarea class="uv-field" readonly="" id="clipboard-value-iframe" style="resize:none;">&lt;iframe width="600px" height="780px" style="border:none;" src="{{ domainInfo[0]~"//"~domainInfo[2] ~ path('formbuilder_create_ticket', {'id': formbuilder.id}) }}" &gt;&lt;/iframe&gt;</textarea>
                            <button class="uv-btn uv-copy-button-iframe" data-copy-target="clipboard-value-iframe" type="button">Copy</button>
                        </div>
                        <div id="puburl-tab" class="uv-tab-view">
                            <div class="uv-element-block">
                                
                                <a href="{{ path('formbuilder_create_ticket', {'id': formbuilder.id}) }}" target="_blank" id="clipboard-value-link">{{ domainInfo[2] ~ path('formbuilder_create_ticket', {'id': formbuilder.id}) }}</a>
                            </div>
                                <a href="{{ path('formbuilder_create_ticket', {'id': formbuilder.id} ) }}" target="_blank">
                                <button class="uv-btn" type="button">Visit</button>
                            </a>
                        </div>
                    </div>
                </div>
                {# EMBED MODAL END #}
            {% endif %}

		</div>
	</div>
{% endblock %}

{% block footer %}
	{{ parent() }}

	<script type="text/javascript">
		$(function () {
            $('.form-name-input').on('input', function() {
                var c = this.selectionStart,
                r = /[^a-z0-9 ]/gi,
                    v = $(this).val();
                    if(r.test(v)) {
                        $(this).val(v.replace(r, ''));
                        c--;
                    }
                this.setSelectionRange(c, c);
            });
            
          $('#preview-modal-btn').click(function() {
              $('#hints').show();
          });
          $('#embed-modal-btn').click(function() {
              $('#embed-modal').show();
          });
        $('.uv-copy-button-js').click(function() { 
                var copyText = document.getElementById("clipboard-value-js");
                copyText.select();
                copyText.setSelectionRange(0, 99999)
                document.execCommand("copy");
                $(this).html("copied");
                setTimeout(function(){ var $btnCopy = $('.uv-copy-button-js');  $btnCopy.text('Copy'); }, 3000);
               });
          $('.uv-copy-button-iframe').click(function() {
                var copyText = document.getElementById("clipboard-value-iframe");
                copyText.select();
                copyText.setSelectionRange(0, 99999)
                document.execCommand("copy");
                $(this).html("copied");
                setTimeout(function(){ var $btnCopy = $('.uv-copy-button-iframe');  $btnCopy.text('Copy');  }, 2000);
          });
            
			var FormBuilderConfigurationModel = Backbone.Model.extend({
                idAttribute: "id",
                validation: {
					form_name: function(value) {
						if (value == undefined || value == '') {
							return "Please specify a valid name for your FormBuilder.";
						}
                    },
				}
			});
            var FormBuilderConfigurationView = Backbone.View.extend({
                events: {
                    'click #embed-btn': 'embedModal',
                    'click .btn-submission' : "validateSubmission",
                },
                initialize: function() {
                    Backbone.Validation.bind(this);
                },
                embedModal: function(e) {
                  
                },
                validateSubmission: function(e) {
                    e.preventDefault();
                    this.model.set(this.$el.serializeObject());
			        if (this.model.isValid(true)) {
			            this.$el.submit();
			        }
                }
            });
			var MailboxConfigurationView = Backbone.View.extend({
                imap_conf_template_custom: _.template($("#imap_conf_template_custom").html()),
                imap_conf_template_predefined: _.template($("#imap_conf_template_predefined").html()),
				events: {
                    'change #cta-mailbox-imap-transport': 'changeImapTransportType',
					'click .btn-submission' : "validateSubmission",
				},
				initialize: function() {
                    Backbone.Validation.bind(this);
                    this.renderTransportConfigurations();
				},
                changeImapTransportType: function(e) {
                    if (true) {
                        this.model.set('transport', $(e.target).val());
                    }
                    this.renderTransportConfigurations();
                },
                renderTransportConfigurations: function() {
                    switch (this.model.get('transport')) {
                        case 'custom':
                            $('.imap-setting-references').html(this.imap_conf_template_custom(this.model.attributes));
                            break;
                        case 'gmail':
                            $('.imap-setting-references').html(this.imap_conf_template_predefined(this.model.attributes));
                            break;
                        case 'yahoo':
                            $('.imap-setting-references').html(this.imap_conf_template_predefined(this.model.attributes));
                            break;
                        default:
                            break;
                    }
                },
                validateSubmission: function(e) {
                    e.preventDefault();
                    this.model.set(this.$el.serializeObject());
			        if (this.model.isValid(true)) {
			            this.$el.submit();
			        }
                }
			});
            {% if mailbox is defined %}
                new MailboxConfigurationView({
                    el: $("#mailbox-settings-view"),
                    model: new MailboxConfigurationModel({
						transport: "{{ mailbox.imapConfiguration.code }}",
						host: "{{ mailbox.imapConfiguration.host }}",
						username: "{{ mailbox.imapConfiguration.username }}",
					})
                });
            {% else %}
                new MailboxConfigurationView({
                    el: $("#mailbox-settings-view"),
                    model: new MailboxConfigurationModel({ transport: 'custom' })
                });
            {% endif %}
		});
	</script>
{% endblock %}